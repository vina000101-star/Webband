<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSANZ - Master Controller</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --bg: #0f1721; --side: #17212b; --active: #2b5278; 
            --text: #f5f5f5; --hint: #708499; --blue: #5288c1; 
            --msg-in: #182533; --msg-out: #2b5278; --header: #17212b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }

        .sidebar { width: 350px; background: var(--side); display: flex; flex-direction: column; border-right: 1px solid #000; }
        .side-head { padding: 15px; background: var(--header); display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #0e161e; }
        .chat-list { flex: 1; overflow-y: auto; }
        .chat-item { display: flex; align-items: center; padding: 12px; cursor: pointer; gap: 12px; border-bottom: 1px solid #1c2833; }
        .chat-item:hover { background: #202b36; }
        .chat-item.active { background: var(--active); }
        
        .avatar { width: 50px; height: 50px; border-radius: 50%; background: var(--blue); display: flex; align-items: center; justify-content: center; font-weight: bold; overflow: hidden; flex-shrink: 0; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        main { flex: 1; display: flex; flex-direction: column; background: #0e161e; }
        .main-head { height: 60px; background: var(--header); display: flex; align-items: center; padding: 0 20px; font-weight: bold; border-bottom: 1px solid #000; }
        .messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg-bubble { max-width: 70%; padding: 10px 15px; border-radius: 15px; font-size: 0.95rem; line-height: 1.4; position: relative; }
        .msg-bubble.in { align-self: flex-start; background: var(--msg-in); color: #fff; }
        .msg-bubble.out { align-self: flex-end; background: var(--msg-out); color: #fff; }
        .time { font-size: 0.7rem; color: var(--hint); display: block; text-align: right; margin-top: 5px; }

        .input-area { background: var(--side); padding: 15px; display: flex; align-items: center; gap: 10px; }
        .input-area input { flex: 1; background: #242f3d; border: none; color: #fff; padding: 12px; border-radius: 10px; outline: none; }
        .send-btn { color: var(--blue); font-size: 1.5rem; cursor: pointer; }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="side-head">
        <div class="avatar" id="botAvatar">X</div>
        <div>
            <h4 id="botName">XSANZ MASTER</h4>
            <p style="font-size: 0.7rem; color: #00ff00;">‚óè Online (Token Active)</p>
        </div>
    </div>
    <div class="chat-list" id="chatList"></div>
    <button onclick="clearHistory()" style="background: #ff4d4d; color: white; border: none; padding: 10px; cursor: pointer; font-weight: bold;">HAPUS SEMUA RIWAYAT</button>
</aside>

<main>
    <div class="main-head" id="activeChatName">Pilih chat untuk memulai...</div>
    <div class="messages" id="msgContainer"></div>
    <div class="input-area">
        <input type="text" id="replyInput" placeholder="Tulis pesan..." onkeypress="if(event.key==='Enter')sendMsg()">
        <i class="fas fa-paper-plane send-btn" onclick="sendMsg()"></i>
    </div>
</main>

<script>
    // TOKEN HARCONDE MILIK YANG MULIA XSANZ
    const BOT_TOKEN = "8343433110:AAFxN1Lb6t15KWeVcxtVZUkK0lfoxI3_YLc";
    
    // AMBIL RIWAYAT CHAT DARI LOCALSTORAGE BIAR GAK ILANG
    let chats = JSON.parse(localStorage.getItem('xsanz_history')) || {}; 
    let activeChatId = null;

    async function fetchUpdates() {
        try {
            const lastId = localStorage.getItem('xsanz_last_update') || 0;
            const r = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${parseInt(lastId)+1}`);
            const d = await r.json();
            
            if(d.ok && d.result.length > 0) {
                for(let u of d.result) {
                    localStorage.setItem('xsanz_last_update', u.update_id);
                    const msg = u.message; if(!msg) continue;
                    const cid = msg.chat.id;
                    
                    if(!chats[cid]) {
                        chats[cid] = { name: msg.from.first_name || "User", msgs: [] };
                    }
                    
                    chats[cid].msgs.push({ 
                        type: 'in', 
                        text: msg.text || "[Media/Sticker]", 
                        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) 
                    });
                }
                saveAndRender();
            }
        } catch(e) { console.error("Koneksi Error:", e); }
    }

    function saveAndRender() {
        localStorage.setItem('xsanz_history', JSON.stringify(chats));
        renderChatList();
        if(activeChatId) renderMessages();
    }

    function renderChatList() {
        const list = document.getElementById('chatList');
        list.innerHTML = Object.keys(chats).reverse().map(id => `
            <div class="chat-item ${activeChatId == id ? 'active' : ''}" onclick="selectChat('${id}')">
                <div class="avatar">${chats[id].name[0]}</div>
                <div style="flex:1; overflow:hidden;">
                    <h4 style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${chats[id].name}</h4>
                    <p style="font-size:0.8rem; color:var(--hint);">${id}</p>
                </div>
            </div>
        `).join('');
    }

    function selectChat(id) {
        activeChatId = id;
        document.getElementById('activeChatName').innerText = "Chat dengan: " + chats[id].name;
        renderChatList();
        renderMessages();
    }

    function renderMessages() {
        const container = document.getElementById('msgContainer');
        const mList = chats[activeChatId].msgs;
        container.innerHTML = mList.map(m => `
            <div class="msg-bubble ${m.type}">
                ${m.text}
                <span class="time">${m.time}</span>
            </div>
        `).join('');
        container.scrollTop = container.scrollHeight;
    }

    async function sendMsg() {
        const inp = document.getElementById('replyInput');
        if(!inp.value || !activeChatId) return;
        
        const text = inp.value;
        try {
            const r = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ chat_id: activeChatId, text: text })
            });
            
            if(r.ok) {
                chats[activeChatId].msgs.push({ 
                    type: 'out', 
                    text: text, 
                    time: new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'}) 
                });
                inp.value = "";
                saveAndRender();
            }
        } catch(e) { alert("Gagal kirim pesan!"); }
    }

    function clearHistory() {
        if(confirm("Hapus semua riwayat chat Mulia XSANZ?")) {
            localStorage.removeItem('xsanz_history');
            chats = {};
            location.reload();
        }
    }

    // Jalankan sistem
    renderChatList();
    setInterval(fetchUpdates, 2500); // Scan chat tiap 2.5 detik
</script>
</body>
</html>
