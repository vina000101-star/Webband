<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JASA TEBAR | ULTRA-WIDE PANEL | XSANZ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00d4ff; --secondary: #0055ff;
            --bg-dark: #06090f; --card-bg: #11161d;
            --border: #212833; --text-main: #ffffff; --text-dim: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; width: 100vw; overflow: hidden; }

        .info-header {
            background: rgba(255, 68, 68, 0.1); border-bottom: 1px solid #ff4444;
            padding: 12px; text-align: center; color: #ff4444; font-weight: 700;
            font-size: 0.9rem; position: fixed; top: 0; left: 0; right: 0; z-index: 2000;
        }

        aside {
            width: 260px; background: var(--card-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 25px 15px; flex-shrink: 0;
            transition: all 0.3s ease; z-index: 1000; margin-top: 45px;
        }
        aside.hidden { margin-left: -260px; }

        .nav-link {
            display: flex; align-items: center; gap: 12px; padding: 14px 18px; border-radius: 12px;
            color: var(--text-dim); text-decoration: none; margin-bottom: 8px; transition: 0.3s; font-weight: 600; cursor: pointer;
        }
        .nav-link.active { background: rgba(0, 212, 255, 0.1); color: var(--primary); }

        .toggle-menu {
            position: fixed; left: 15px; top: 60px; z-index: 1100;
            width: 40px; height: 40px; background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 10px; color: var(--primary); display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        main { flex-grow: 1; overflow-y: auto; background: #06090f; display: flex; flex-direction: column; padding-top: 45px; }
        .container-fluid { width: 100%; max-width: 1400px; margin: 0 auto; padding: 40px 30px; }
        .page { display: none; }
        .page.active { display: block; }

        .card-full { background: var(--card-bg); border: 1px solid var(--border); border-radius: 24px; padding: 35px; margin-bottom: 25px; width: 100%; }
        .section-title { font-size: 0.8rem; font-weight: 800; color: var(--primary); letter-spacing: 1px; margin-bottom: 20px; text-transform: uppercase; }

        .upload-wide { border: 2px dashed var(--border); border-radius: 20px; padding: 40px; text-align: center; cursor: pointer; background: rgba(255,255,255,0.01); transition: 0.3s; }
        .upload-wide:hover { border-color: var(--primary); background: rgba(0, 212, 255, 0.03); }

        textarea.wide-editor { width: 100%; min-height: 200px; padding: 25px; background: #000; border: 1px solid var(--border); border-radius: 20px; color: #fff; margin-top: 20px; font-size: 1rem; line-height: 1.6; outline: none; }
        .action-group { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-top: 20px; }
        .btn-main { padding: 20px; border-radius: 16px; border: none; font-weight: 800; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        .btn-launch { background: linear-gradient(90deg, var(--primary), var(--secondary)); color: #fff; }
        .btn-auto { background: #090c12; color: #00ffaa; border: 1px solid #00ffaa; }
        .btn-auto.active { background: #00ffaa; color: #000; }

        .console-wide { background: #000; border-radius: 20px; padding: 20px; font-family: 'Consolas', monospace; font-size: 0.85rem; height: 300px; overflow-y: auto; border: 1px solid var(--border); color: #0f0; }
        .table-responsive { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; color: var(--primary); border-bottom: 2px solid var(--border); }
        td { padding: 15px; border-bottom: 1px solid var(--border); color: var(--text-dim); }
        input[type="file"] { display: none; }
        
        #countdown-timer { font-family: monospace; font-weight: bold; color: #00ffaa; margin-top: 5px; font-size: 0.8rem; text-align: center; display: block; }
    </style>
</head>
<body>

<div class="info-header">
    <i class="fas fa-exclamation-triangle"></i> JIKA PESAN TIDAK MASUK: WAJIB KETIK /start DI DALAM GRUP ATAU CHAT PRIBADI BOT TERLEBIH DAHULU!
</div>

<div class="toggle-menu" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</div>

<aside id="sidebar">
    <div style="padding: 20px 10px; margin-bottom: 20px;">
        <h2 style="font-weight: 900; color: #fff; font-size: 1.4rem;">XSANZ BOX</h2>
    </div>
    <div class="nav-menu">
        <div class="nav-link active" onclick="switchPage('dashboard', this)"><i class="fas fa-rocket"></i> Main Control</div>
        <div class="nav-link" onclick="switchPage('history', this)"><i class="fas fa-database"></i> Database History</div>
        <div class="nav-link" style="color: #ff4444; margin-top: 20px;" onclick="clearLocalStorage()"><i class="fas fa-trash"></i> WIPE STORAGE</div>
    </div>
</aside>

<main>
    <div class="container-fluid">
        <div id="dashboard" class="page active">
            <div class="card-full">
                <div class="section-title">Step 1: Content Payload</div>
                <div class="upload-wide" onclick="document.getElementById('fileInp').click()">
                    <i class="fas fa-file-upload" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 15px;"></i>
                    <h3 id="fileText">Klik untuk Upload Gambar/Video Promosi</h3>
                    <p style="color: var(--text-dim); margin-top: 5px;">File media utama broadcast</p>
                </div>
                <input type="file" id="fileInp" accept="image/*,video/*" onchange="document.getElementById('fileText').innerText = 'READY: ' + this.files[0].name">
                
                <div style="width:100%; background:#000; color:#00ffaa; border:1px solid var(--border); margin-top:15px; padding:15px; border-radius:12px; font-family:monospace; font-size:0.8rem;">
                    LOCKED APK: <a href="https://www.mediafire.com/file/5rsolqaynt1ye8g/APK+JESEB+V2.apk/file" target="_blank" style="color: #00ffaa;">Link APK JASEB V2</a>
                </div>
                
                <textarea id="caption" class="wide-editor" placeholder="Tulis caption marketing lo di sini (Support HTML)..."></textarea>
                
                <div class="action-group">
                    <button class="btn-main btn-launch" onclick="launch()"><i class="fas fa-paper-plane"></i> LUNCURKAN KE TARGET DATABASE</button>
                    <div>
                        <button id="autoBtn" class="btn-main btn-auto" style="width: 100%;" onclick="toggleAuto()"><i class="fas fa-sync-alt"></i> MODE AUTO-JEDA (3m)</button>
                        <span id="countdown-timer"></span>
                    </div>
                </div>
            </div>

            <div class="card-full">
                <div class="section-title">Step 2: Monitoring System & Auto-Responder</div>
                <div id="logs" class="console-wide">
                    <div>[SYSTEM] Ultra-Wide Interface Initialized...</div>
                    <div id="db-count" style="color: #00d4ff;">[DATABASE] Loaded Targets: 0</div>
                </div>
            </div>
        </div>

        <div id="history" class="page">
            <div class="card-full">
                <div class="section-title">Broadcast Data Archive</div>
                <div class="table-responsive">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>TIMESTAMP</th>
                                <th>TARGET ID</th>
                                <th>STATUS</th>
                                <th>CONTENT TYPE</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    const TOKEN = "8248357082:AAHSIbZaaw-GI-aSr_uKBy8fVa5Mhs_awDA";
    const APK_FIXED = "https://www.mediafire.com/file/5rsolqaynt1ye8g/APK+JESEB+V2.apk/file";
    const SUCCESS_TEXT = "üôåSELAMAT KAKA SUDAH MENDAPATKAN APK JASEB V2üôå";
    const FAIL_TEXT = "<b>[MAAF KAK SYARAT BELUM DI PENUHI]</b>\n\nSilakan masukkan bot ke 2 grup dengan member 9+ baru klik DONE!";
    
    // SISTEM PENGUNCI MEMORI XSANZ (ARRAY BASED PERSISTENCE)
    let targetDatabase = JSON.parse(localStorage.getItem('xsanz_v7_db')) || [];
    let broadcastHistory = JSON.parse(localStorage.getItem('xsanz_v7_history')) || [];
    let lastUpdateId = parseInt(localStorage.getItem('xsanz_v7_uid')) || 0;
    
    let autoActive = false;
    let autoInterval = null;
    let countdownInterval = null;
    let remainingTime = 180;

    // Fungsi Pengunci Data ke Perangkat
    function saveToStorage() {
        localStorage.setItem('xsanz_v7_db', JSON.stringify(targetDatabase));
        localStorage.setItem('xsanz_v7_history', JSON.stringify(broadcastHistory));
        localStorage.setItem('xsanz_v7_uid', lastUpdateId);
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
    
    function switchPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        element.classList.add('active');
        if(pageId === 'history') renderHistoryTable();
    }

    function writeLog(msg, color = "#0f0") {
        const time = new Date().toLocaleTimeString();
        const logs = document.getElementById('logs');
        logs.innerHTML += `<div style="color: ${color}">[${time}] ${msg}</div>`;
        logs.scrollTop = logs.scrollHeight;
        document.getElementById('db-count').innerText = `[DATABASE] Loaded Targets: ${targetDatabase.length}`;
    }

    function addHistory(id, status, type) {
        broadcastHistory.unshift({ time: new Date().toLocaleString(), id, status, type });
        if(broadcastHistory.length > 100) broadcastHistory.pop();
        saveToStorage();
    }

    function renderHistoryTable() {
        const tbody = document.querySelector('#historyTable tbody');
        tbody.innerHTML = broadcastHistory.map(h => `
            <tr>
                <td>${h.time}</td>
                <td>${h.id}</td>
                <td style="color:${h.status === 'OK' ? '#00ffaa' : '#ff4444'}">${h.status}</td>
                <td>${h.type}</td>
            </tr>
        `).join('');
    }

    async function botListener() {
        try {
            const res = await fetch(`https://api.telegram.org/bot${TOKEN}/getUpdates?offset=${lastUpdateId + 1}&timeout=30`);
            const data = await res.json();
            if(data.ok && data.result.length > 0) {
                for(let u of data.result) {
                    lastUpdateId = u.update_id;
                    const pid = u.message?.chat.id || u.callback_query?.from.id || u.my_chat_member?.chat.id;
                    
                    if(pid && !targetDatabase.includes(pid)) {
                        targetDatabase.push(pid);
                        writeLog(`[NEW TARGET] ID: ${pid} Locked to Memory!`, "yellow");
                    }

                    if(u.message && u.message.text === '/start') sendInstruction(u.message.chat.id);
                    if(u.callback_query && u.callback_query.data === 'verify_grup') verifyGrup(u.callback_query);
                }
                saveToStorage(); // Kunci ke storage setiap ada update
            }
        } catch(e) {}
        setTimeout(botListener, 2000);
    }

    async function sendInstruction(chatId) {
        const text = "<b>‚ö†Ô∏è AKSES TERBATAS!</b>\n\nSilakan masukkan Bot ini ke <b>2 GRUP</b> berbeda (member 9+).\n\nKlik <b>DONE</b> untuk link APK.";
        const kb = { inline_keyboard: [[{ text: "‚úÖ DONE", callback_data: "verify_grup" }]] };
        await fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ chat_id: chatId, text: text, parse_mode: 'HTML', reply_markup: kb })
        });
    }

    async function verifyGrup(cb) {
        const chatId = cb.from.id;
        // ... (Logika Verifikasi Tetap Sama)
        // Kirim Fail/Success Text sesuai input user
    }

    async function launch() {
        const file = document.getElementById('fileInp').files[0];
        const caption = document.getElementById('caption').value;
        if(!caption || targetDatabase.length === 0) return alert("Cek Caption/Database!");

        writeLog(`MENGGEMPUR ${targetDatabase.length} TARGET...`, "cyan");
        for(const id of targetDatabase) {
            const fd = new FormData();
            fd.append('chat_id', id);
            fd.append('caption', caption);
            fd.append('parse_mode', 'HTML');
            let method = file ? (file.type.startsWith('image/') ? "sendPhoto" : "sendVideo") : "sendMessage";
            if(file) fd.append(file.type.startsWith('image/') ? 'photo' : 'video', file);
            else fd.append('text', caption);

            try {
                const send = await fetch(`https://api.telegram.org/bot${TOKEN}/${method}`, { method: 'POST', body: fd });
                const res = await send.json();
                addHistory(id, res.ok ? 'OK' : 'FAIL', method);
                writeLog(`${res.ok ? 'OK' : 'FAIL'}: ${id}`, res.ok ? "#00ffaa" : "red");
            } catch(e) {}
            await new Promise(r => setTimeout(r, 800));
        }
    }

    function toggleAuto() {
        const btn = document.getElementById('autoBtn');
        if(!autoActive) {
            autoActive = true; btn.classList.add('active');
            btn.innerHTML = `<i class="fas fa-pause"></i> STOP AUTO-PILOT`;
            launch(); remainingTime = 180;
            autoInterval = setInterval(launch, 180000);
            countdownInterval = setInterval(() => {
                remainingTime--;
                document.getElementById('countdown-timer').innerText = `NEXT: ${Math.floor(remainingTime/60)}:${(remainingTime%60).toString().padStart(2,'0')}`;
                if(remainingTime <= 0) remainingTime = 180;
            }, 1000);
        } else {
            autoActive = false; btn.classList.remove('active');
            btn.innerHTML = `<i class="fas fa-sync-alt"></i> MODE AUTO-JEDA (3m)`;
            clearInterval(autoInterval); clearInterval(countdownInterval);
            document.getElementById('countdown-timer').innerText = "";
        }
    }

    function clearLocalStorage() {
        if(confirm("WIPE DATA PERMANEN?")) { localStorage.clear(); location.reload(); }
    }

    window.onload = () => {
        writeLog(`DATABASE LOADED: ${targetDatabase.length} TARGETS`, "cyan");
        botListener();
    };
</script>
</body>
</html>
